<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PlanetForge (Vite + TS)</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <canvas id="game"></canvas>

    <!-- HUD -->
    <div id="hud" class="panel">
      <div><strong>PlanetForge MVP</strong></div>
      <div>Planet Lv <span id="pLv">1</span> • Territory: <span id="terr">200</span>u</div>
      <div>Money: <span id="money">0</span></div>
      <div>Basalt: <span id="basalt">0</span> • Energy: <span id="energy">0</span></div>
      <div>Moons: <span id="moons">0</span> (+<span id="bRate">0</span>/s) • Satellites: <span id="sats">0</span> (+<span id="eRate">0</span>/s)</div>
      <div>Ships — Drones: <span id="drCount">0</span> • Battleships: <span id="bsCount">0</span> • Missions: <span id="msCount">0</span></div>
      <div class="muted" style="margin-top:4px">
        R-drag: pan • Wheel: zoom • <span class="kbd">H</span> shop • Click planet/buildings to manage •
        Drag from shop to place buildings • Right-click to cancel placement • Click scraps for actions
      </div>
      <div class="row">
        <button id="shopBtn">Open Shop</button>
        <button id="recruitBtn">Recruit</button>
      </div>
    </div>

    <!-- Shop -->
    <div id="shop" class="panel" style="display:none;">
      <h3>Shop</h3>
      <div class="muted">Build buildings & trade resources.</div>
      <section>
        <strong>Build</strong>
        <div class="row">
          <div>Moon — +1 basalt/s/level</div>
          <div><span class="muted" id="moonCost">100</span><button id="startMoon">Select</button></div>
        </div>
        <div class="row">
          <div>Satellite — +1 energy/s/level</div>
          <div><span class="muted" id="satCost">120</span><button id="startSat">Select</button></div>
        </div>
      </section>
      <section>
        <strong>Trade</strong>
        <div class="row">
          <div>Basalt → money</div>
          <div>
            <input id="sellBasaltAmt" type="number" min="0" step="1" placeholder="amount" />
            <button id="sellBasalt">Sell</button>
          </div>
        </div>
        <div class="row">
          <div>Energy → money</div>
          <div>
            <input id="sellEnergyAmt" type="number" min="0" step="1" placeholder="amount" />
            <button id="sellEnergy">Sell</button>
          </div>
        </div>
        <div style="text-align:right; margin-top:6px"><button id="closeShop">Close</button></div>
      </section>
    </div>

    <!-- Detail Panel (planet/building) -->
    <div id="detailPanel" class="panel" style="display:none;">
      <div><strong id="panelTitle">Details</strong></div>
      <div class="row"><div>Level</div><div><span id="bLvl">1</span> / 10</div></div>
      <div class="row" id="rowProd"><div id="prodLabel">Prod</div><div><span id="bProd">+1</span></div></div>
      <div class="row"><div>Upgrade</div><div><button id="bUpgrade">Upgrade (<span id="bUpCost">—</span>)</button></div></div>
      <div class="row" id="rowDemo"><div>Demolish</div><div><button id="bDemo">Refund 75%</button></div></div>
      <div style="text-align:right; margin-top:6px"><button id="bClose">Close</button></div>
    </div>

    <!-- Scrap radial menu -->
    <div id="scrapMenu" style="display:none;">
      <div class="ring"></div>
      <div class="btn" id="scrapCollectBtn" title="Collect Resources">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="9" stroke="#384fff" stroke-width="2"/>
          <circle cx="12" cy="12" r="3" fill="#ff3d3d"/>
          <path d="M12 3v3M12 18v3M3 12h3M18 12h3" stroke="#384fff" stroke-width="2"/>
        </svg>
      </div>
      <div class="label">Collect Resources</div>
    </div>

    <!-- Collect dialog (you already had a working version) -->
    <div id="collect" class="panel" style="display:none; min-width:520px;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
        <strong>Collect from Scrap</strong>
        <button id="closeCollect">Close</button>
      </div>
      <div class="muted" id="collectInfo" style="margin:6px 0 10px;">—</div>

      <div class="row" style="gap:8px; align-items:center;">
        <div class="ship-pill" draggable="true" data-type="drone" title="Drag to slot">
          Drone <span class="count" id="invD">0</span>
        </div>
        <div class="ship-pill" draggable="true" data-type="battle" title="Drag to slot">
          Battleship <span class="count" id="invB">0</span>
        </div>
        <div style="margin-left:auto; display:flex; gap:8px;">
          <button id="autoFill">Autofill</button>
          <button id="clearSlots">Clear</button>
        </div>
      </div>

      <div class="slot-grid" id="slots" style="margin:8px 0 4px;"></div>
      <div class="muted" style="margin-top:0">Tip: drag a ship into a slot; right-click a slot to clear it. Click a slot to edit its amount.</div>

      <!-- Slot editor -->
      <div id="slotEditor" class="slot-editor" style="display:none;">
        <div class="row"><div>Type:</div><div><strong id="seType">Drone</strong></div></div>
        <div class="row"><div>Available:</div><div><span id="seAvail">0</span></div></div>
        <div class="row">
          <div>Qty</div>
          <div><input id="seQty" type="number" min="0" step="1" value="0" style="width:90px" /></div>
        </div>
        <input id="seRange" type="range" min="0" max="0" step="1" style="width:100%; margin-top:4px;" />
        <div class="row" style="justify-content:flex-end; gap:6px; margin-top:6px;">
          <button id="seMax">Max</button>
          <button id="seApply">Apply</button>
          <button id="seCancel">Cancel</button>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>Selected — Drones: <span id="selD">0</span> • Battleships: <span id="selB">0</span></div>
        <div>Capacity: <span id="cap">0</span></div>
        <div>ETA: <span id="eta">—</span></div>
      </div>

      <div class="row" style="justify-content:flex-end; margin-top:8px;">
        <button id="sendFleet">Send</button>
      </div>
    </div>

    <!-- Recruitment Panel -->
    <div id="recruit" class="panel" style="display:none; min-width:760px;">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <strong>Recruit</strong>
        <button id="recruitClose">Close</button>
      </div>

      <!-- Active recruitment slots -->
      <div id="rcSlots"></div>

      <hr style="border-color:rgba(255,255,255,.15)">

      <!-- Type picker -->
      <div class="row" style="gap:8px;">
        <div class="ship-pill pick" data-pick="drone">Drone (cost <span id="rcDroneCost">25</span>, <span id="rcDroneTime">1</span>s)</div>
        <div class="ship-pill pick" data-pick="battle">Battleship (cost <span id="rcBattleCost">100</span>, <span id="rcBattleTime">2</span>s)</div>
      </div>

      <!-- Quantity chooser -->
      <div class="row">
        <div>Amount</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <input id="rcQty" type="number" min="1" step="1" value="10" style="width:110px;">
          <input id="rcRange" type="range" min="1" max="100" step="1" style="width:260px;">
          <button id="rcMax">Max</button>
        </div>
      </div>

      <!-- Preview -->
      <div class="row">
        <div>Total cost</div><div><strong id="rcCost">0</strong></div>
      </div>
      <div class="row">
        <div>Total time</div><div><strong id="rcTime">0s</strong></div>
      </div>
      <div class="row">
        <div>Free slots</div><div><strong id="rcFree">0</strong> / <span id="rcMaxSlots">0</span></div>
      </div>

      <div style="text-align:right; margin-top:6px;">
        <button id="rcConfirm">Start Recruitment</button>
      </div>
    </div>

    <div id="toast" class="toast" style="display:none;"></div>

    <script type="module" src="/src/main.ts"></script>
    <script type="module">
      import { wireRecruit } from '/src/ui/recruit.ts';
      wireRecruit(); // self-inits its own RAF for progress + DOM refresh
    </script>
  </body>
</html>
